# Changelog

Все значительные изменения в Starvell Cardinal будут документироваться в этом файле.

## [0.0.8] - 2026-01-07

### Добавлено

- **Команда**: Добавлена команда `/changelog` для просмотра истории изменений прямо в боте
- **Документация**: Добавлен полный **API Reference** (`docs/API_REFERENCE.md`) с примерами возвращаемых данных всех методов StarvellService
- **Документация**: Обновлен `docs/example_plugin.py` с современными async/await паттернами и примерами работы с API
- **Документация**: Добавлены примеры работы с хранилищем данных плагинов
- **Документация**: Добавлены FAQ и Best Practices для разработчиков плагинов

### Улучшено

- **Plugin System**: Обновлена система передачи параметров в обработчики событий
  - `on_new_order` теперь получает `starvell_service` для доступа к API
  - `on_new_message` теперь получает `starvell_service` для отправки сообщений
  - Все обработчики жизненного цикла получают `bot`, `starvell`, `db`, `plugin_manager`
- **Notifications**: NotificationManager теперь передает `starvell_service` в обработчики плагинов
- **Notifications**: Исправлена передача параметров через всю цепочку: bot_core → notifications → plugin handlers
- **Документация**: Полностью обновлена `docs/PLUGINS_API.md`:
  - Добавлены актуальные структуры данных для `order_data` и `message_data`
  - Добавлены реальные примеры данных из API
  - Добавлена документация всех методов StarvellService
  - Добавлены примеры использования с async/await
  - Добавлен раздел "Полезные советы" и "FAQ"
- **README**: Обновлен раздел документации с ссылками на новые руководства

### Исправлено

- **Plugin System**: Исправлена передача `starvell_service` в обработчики плагинов (был None)
- **Plugin System**: `order_data['chat_id']` теперь корректно извлекается из `pageProps.chat.id`
- **Plugin System**: `message_data['author']` теперь корректно содержит ID покупателя (buyerId)

### Документация

Новые файлы документации:
- `docs/API_REFERENCE.md` - Справочник API с примерами всех методов и структур данных
- `docs/QUICK_START.md` - Пошаговое руководство создания плагина
- `docs/example_plugin.py` v2.0.0 - Обновленный пример с современным кодом

Обновленные файлы:
- `docs/PLUGINS_API.md` - Полное руководство разработчика плагинов
- `README.md` - Добавлены ссылки на новую документацию

## [0.0.8] - 2026-01-06

### Добавлено

- **API Client**: Добавлен метод `get_order_details(order_id)` для получения полной информации о заказе включая chat_id
- **StarService**: Добавлен метод `get_order_details(order_id)` для получения деталей заказа
- **API Client**: Добавлен метод `find_chat_by_user_id()` для поиска чата с конкретным пользователем
- **StarService**: Добавлен метод `find_chat_by_user_id()` для поиска чата по ID пользователя
- **Plugin System**: Добавлена передача starvell_service в хэндлеры (Плагины теперь получают доступ к API Starvell через параметр `starvell_service`)

### Исправлено

- **Plugin System**: Добавлен `chat_id` покупателя в данные события `BIND_TO_NEW_ORDER`

### Улучшено

- **Plugin System**: Исправлена интеграция плагинов с системой уведомлений
- **Документация**: Обновлена документация PLUGINS_API.md с описанием поля `chat_id` в данных заказа
